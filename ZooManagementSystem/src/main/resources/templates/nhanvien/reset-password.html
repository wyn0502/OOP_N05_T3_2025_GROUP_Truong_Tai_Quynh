<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Đặt lại mật khẩu - Zoo Management</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
</head>
<body class="bg-light">

<div class="container my-5" style="max-width: 640px;">
  <!-- Back -->
  <a href="/nhanvien" class="btn btn-outline-secondary mb-4">
    <i class="fas fa-arrow-left me-2"></i> Quay lại danh sách nhân viên
  </a>

  <h2 class="text-center text-danger mb-4">
    <i class="fas fa-key me-2"></i>Đổi mật khẩu cho nhân viên
  </h2>

  <!-- Flash messages -->
  <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
    <i class="fa-solid fa-circle-check me-2"></i><span th:text="${success}">Thành công</span>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
  <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
    <i class="fa-solid fa-triangle-exclamation me-2"></i><span th:text="${error}">Có lỗi xảy ra</span>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
  <div th:if="${warning}" class="alert alert-warning alert-dismissible fade show" role="alert">
    <i class="fa-solid fa-circle-exclamation me-2"></i><span th:text="${warning}">Cảnh báo</span>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>

  <!-- Form -->
  <form th:action="@{/nhanvien/reset-password/{id}(id=${userId})}" method="post"
        class="bg-white p-4 rounded shadow-sm needs-validation" novalidate
        onsubmit="return validatePasswords();">
    <!-- Nếu có Spring Security, bật dòng dưới: -->
    <!-- <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/> -->

    <div class="mb-3">
      <label for="newPassword" class="form-label fw-semibold">
        <i class="fas fa-lock me-2"></i>Mật khẩu mới
      </label>
      <div class="input-group">
        <input type="password" class="form-control" name="newPassword" id="newPassword"
               placeholder="Nhập mật khẩu mới" minlength="6" required>
        <button type="button" class="btn btn-outline-secondary" onclick="togglePw('newPassword')">
          <i class="fa-solid fa-eye"></i>
        </button>
      </div>
      <div class="form-text">Tối thiểu 6 ký tự (khuyến nghị có chữ hoa, số, ký tự đặc biệt).</div>
      <div class="invalid-feedback">Vui lòng nhập mật khẩu hợp lệ (≥ 6 ký tự).</div>
    </div>

    <div class="mb-3">
      <label for="confirmPassword" class="form-label fw-semibold">
        <i class="fas fa-lock me-2"></i>Xác nhận mật khẩu
      </label>
      <div class="input-group">
        <input type="password" class="form-control" name="confirmPassword" id="confirmPassword"
               placeholder="Xác nhận lại mật khẩu" required>
        <button type="button" class="btn btn-outline-secondary" onclick="togglePw('confirmPassword')">
          <i class="fa-solid fa-eye"></i>
        </button>
      </div>
      <div class="invalid-feedback">Xác nhận mật khẩu không khớp.</div>
    </div>

    <div class="d-flex justify-content-end gap-2 mt-4">
      <button type="submit" class="btn btn-primary">
        <i class="fas fa-save me-2"></i> Cập nhật mật khẩu
      </button>
      <a href="/nhanvien" class="btn btn-secondary">
        <i class="fas fa-times me-2"></i> Hủy
      </a>
    </div>
  </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Bootstrap client-side validation
  (function () {
    const forms = document.querySelectorAll('.needs-validation');
    Array.prototype.slice.call(forms).forEach(function (form) {
      form.addEventListener('submit', function (event) {
        if (!form.checkValidity()) {
          event.preventDefault(); event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    });
  })();

  function validatePasswords() {
    const p1 = document.getElementById('newPassword').value.trim();
    const p2 = document.getElementById('confirmPassword').value.trim();
    if (p1.length < 6) return false;
    if (p1 !== p2) {
      document.getElementById('confirmPassword').setCustomValidity('Mismatch');
      return false;
    }
    document.getElementById('confirmPassword').setCustomValidity('');
    return true;
  }

  function togglePw(id) {
    const el = document.getElementById(id);
    el.type = el.type === 'password' ? 'text' : 'password';
  }
</script>
</body>
</html>
