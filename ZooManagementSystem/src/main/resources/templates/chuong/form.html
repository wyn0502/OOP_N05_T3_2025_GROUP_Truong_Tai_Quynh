<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title th:text="${mode == 'add'} ? 'Thêm Chuồng' : 'Chỉnh Sửa Chuồng'">Chuồng</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
</head>
<body class="bg-light">

<div class="container my-5" style="max-width: 520px;">
  <h2 class="text-center text-success mb-4">
    <i class="fas fa-house-damage fa-lg me-2"></i>
    <span th:text="${mode == 'add'} ? 'Thêm Chuồng Mới' : 'Chỉnh Sửa Chuồng'">Thêm Chuồng Mới</span>
  </h2>

  <!-- Thông báo lỗi (nếu có) -->
  <div th:if="${error}" class="alert alert-danger mb-4" th:text="${error}"></div>

  <form th:action="@{/chuong/luu}" th:object="${chuong}" method="post" novalidate id="chuongForm">
    <!-- Ẩn mode để biết đang thêm/sửa -->
    <input type="hidden" name="mode" th:value="${mode}"/>

    <!-- Mã chuồng -->
    <div class="mb-3">
      <label for="maChuong" class="form-label fw-semibold">
        <i class="fas fa-barcode me-2"></i>Mã chuồng
      </label>
      <input type="text"
             class="form-control"
             id="maChuong"
             th:field="*{maChuong}"
             th:readonly="${mode == 'edit'}"
             placeholder="Nhập mã chuồng"
             required />
      <div class="invalid-feedback">Vui lòng nhập mã chuồng.</div>
    </div>

    <!-- Tên khu vực -->
    <div class="mb-3">
      <label for="tenKhuVuc" class="form-label fw-semibold">
        <i class="fas fa-map-marker-alt me-2"></i>Tên khu vực
      </label>
      <input type="text"
             class="form-control"
             id="tenKhuVuc"
             th:field="*{tenKhuVuc}"
             placeholder="Nhập tên khu vực"
             required />
      <div class="invalid-feedback">Vui lòng nhập tên khu vực.</div>
    </div>

    <!-- Sức chứa tối đa -->
    <div class="mb-3">
      <label for="sucChuaToiDa" class="form-label fw-semibold">
        <i class="fas fa-users me-2"></i>Sức chứa tối đa
      </label>
      <input type="number"
             class="form-control"
             id="sucChuaToiDa"
             th:field="*{sucChuaToiDa}"
             placeholder="Nhập sức chứa tối đa"
             min="1"
             required />
      <div class="invalid-feedback">Vui lòng nhập sức chứa lớn hơn 0.</div>
    </div>

    <!-- SỬA: Chỉ hiển thị "Số lượng hiện tại" khi EDIT -->
    <div th:if="${mode == 'edit'}" class="mb-3">
      <label for="soLuongHienTai" class="form-label fw-semibold">
        <i class="fas fa-dog me-2"></i>Số lượng hiện tại
      </label>
      <input type="number"
             class="form-control bg-light"
             id="soLuongHienTai"
             th:field="*{soLuongHienTai}"
             readonly
             title="Số lượng được cập nhật tự động khi thêm/xóa động vật" />
      <small class="form-text text-muted">
        <i class="fas fa-info-circle me-1"></i>
        Số lượng được cập nhật tự động khi thêm/xóa động vật
      </small>
    </div>

    <!-- SỬA: Thông báo khi thêm mới -->
    <div th:if="${mode == 'add'}" class="alert alert-info mb-3">
      <i class="fas fa-info-circle me-2"></i>
      <strong>Lưu ý:</strong> Chuồng mới sẽ bắt đầu với 0 động vật. 
      Số lượng sẽ được cập nhật tự động khi bạn thêm động vật vào chuồng.
    </div>

    <button type="submit" class="btn btn-success w-100 fw-semibold mb-2" id="submitBtn">
      <i class="fas fa-save me-2"></i>
      <span th:text="${mode == 'add'} ? 'Tạo Chuồng' : 'Cập Nhật'">Lưu Lại</span>
    </button>
    <div class="text-center">
      <a href="/chuong" class="text-success text-decoration-none fw-semibold">
        <i class="fas fa-arrow-left me-2"></i>Quay lại danh sách
      </a>
    </div>
  </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  (() => {
    'use strict';
    const form = document.getElementById('chuongForm');
    form.addEventListener('submit', function(event) {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add('was-validated');
    }, false);
  })();
</script>
</body>
</html>
